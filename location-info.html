<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Location Details | IP Insight Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./src/styles/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
     <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
     <script src="https://lawson-mutsa.github.io/geolocation-web-app/src/scripts/scripts.js" defer></script>
  </head>
  <body>
    <!-- Loading Animation -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Gathering location data...</p>
      </div>
    </div>

    <header>
      <div class="header-content">
        <div class="logo-container">
          <a href="index.html" class="logo-link">
            <img src="/images/logo.png" alt="IP Insight Logo" width="40" height="40">
            <span class="logo-text">IP Insight</span>
          </a>
        </div>
        <nav>
          <a href="index.html" class="nav-link">Home</a>
          <a href="recent-searches.html" class="nav-link">Recent</a>
        </nav>
      </div>
    </header>

    <main class="location-info-main">
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">
            <span class="title-icon">‚ÑπÔ∏è</span>
            Location Information
          </h1>
          <button class="back-btn" onclick="window.history.back()">
            <span class="btn-icon">‚Üê</span>
            Back to Search
          </button>
        </div>

        <div class="location-info-grid">
          <!-- IP Address Card -->
          <div class="info-card ip-card">
            <div class="card-header">
              <h2>
                <span class="card-icon">üíª</span>
                IP Address
              </h2>
              <button class="copy-btn" id="copyIpBtn" title="Copy IP Address">
                <span class="copy-icon">üìã</span>
              </button>
            </div>
            <div class="card-content">
              <div class="ip-display" id="ipDisplay">
                <span class="ip-value">Loading...</span>
                <span class="ip-type" id="ipType"></span>
              </div>
            </div>
          </div>

          <!-- Location Details Card -->
          <div class="info-card location-card">
            <div class="card-header">
              <h2>
                <span class="card-icon">üó∫Ô∏è</span>
                Location Details
              </h2>
              <button class="copy-btn" id="copyLocationBtn" title="Copy Location Info">
                <span class="copy-icon">üìã</span>
              </button>
            </div>
            <div class="card-content">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Country</span>
                  <span class="info-value" id="countryValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">City</span>
                  <span class="info-value" id="cityValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Region</span>
                  <span class="info-value" id="regionValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Coordinates</span>
                  <span class="info-value" id="coordinatesValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Address</span>
                  <span class="info-value" id="addressValue">‚Äî</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Network Information Card -->
          <div class="info-card network-card">
            <div class="card-header">
              <h2>
                <span class="card-icon">üåê</span>
                Network Information
              </h2>
              <button class="copy-btn" id="copyNetworkBtn" title="Copy Network Info">
                <span class="copy-icon">üìã</span>
              </button>
            </div>
            <div class="card-content">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">ISP</span>
                  <span class="info-value" id="ispValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Organization</span>
                  <span class="info-value" id="orgValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Hostname</span>
                  <span class="info-value" id="hostnameValue">‚Äî</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Time Information Card -->
          <div class="info-card time-card">
            <div class="card-header">
              <h2>
                <span class="card-icon">‚è∞</span>
                Time Information
              </h2>
              <button class="copy-btn" id="copyTimeBtn" title="Copy Time Info">
                <span class="copy-icon">üìã</span>
              </button>
            </div>
            <div class="card-content">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Timezone</span>
                  <span class="info-value" id="timezoneValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Local Time</span>
                  <span class="info-value" id="localTimeValue">‚Äî</span>
                </div>
                <div class="info-item">
                  <span class="info-label">UTC Offset</span>
                  <span class="info-value" id="utcOffsetValue">‚Äî</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Map Container -->
          <div class="info-card map-card">
            <div class="card-header">
              <h2>
                <span class="card-icon">üó∫Ô∏è</span>
                Location Map
              </h2>
              <div class="map-actions">
                <button class="map-btn" id="zoomInBtn" title="Zoom In">
                  <span class="map-icon">+</span>
                </button>
                <button class="map-btn" id="zoomOutBtn" title="Zoom Out">
                  <span class="map-icon">‚àí</span>
                </button>
                <button class="map-btn" id="locateBtn" title="Recenter Map">
                  <span class="map-icon">‚åñ</span>
                </button>
              </div>
            </div>
            <div class="card-content">
              <div class="map-container" id="mapContainer">
                <div class="map-placeholder">
                  <span class="map-placeholder-icon">üó∫Ô∏è</span>
                  <p>Loading interactive map...</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="action-btn primary" id="newSearchBtn">
            <span class="btn-icon">üîç</span>
            New Search
          </button>
          <button class="action-btn secondary" id="saveSearchBtn">
            <span class="btn-icon">üíæ</span>
            Save Search
          </button>
        </div>
      </div>
    </main>

    <!-- Notification Toast -->
    <div class="toast" id="toast"></div>
  <script>
// Complete location-info.html functionality
document.addEventListener('DOMContentLoaded', function() {
    console.log("Setting up location-info page functionality...");
    
    // ===== NEW SEARCH BUTTON =====
    const newSearchBtn = document.getElementById('newSearchBtn');
    console.log("New Search button found:", !!newSearchBtn);
    
    if (newSearchBtn) {
        newSearchBtn.addEventListener('click', function() {
            console.log("üîÑ New Search button clicked - redirecting to index.html");
            window.location.href = "index.html";
        });
    }
    
    // ===== SAVE SEARCH BUTTON =====
    const saveBtn = document.getElementById('saveSearchBtn');
    console.log("Save Search button found:", !!saveBtn);
    
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            console.log("üéØ SAVE SEARCH BUTTON CLICKED! üéØ");
            
            // Get all the current displayed data
            const ip = document.querySelector("#ipDisplay .ip-value")?.textContent?.trim() || "";
            const ipType = document.querySelector("#ipDisplay .ip-type")?.textContent?.trim() || "IPv4";
            
            console.log("IP to save:", ip);
            
            // Check if we have valid data
            if (!ip || ip === "Loading..." || ip === "Unknown") {
                alert("No valid IP data to save. Please wait for data to load.");
                return;
            }

            // Get all the location and network data
            const country = document.getElementById("countryValue")?.textContent?.trim() || "‚Äî";
            const city = document.getElementById("cityValue")?.textContent?.trim() || "‚Äî";
            const region = document.getElementById("regionValue")?.textContent?.trim() || "‚Äî";
            const coordinates = document.getElementById("coordinatesValue")?.textContent?.trim() || "‚Äî";
            const address = document.getElementById("addressValue")?.textContent?.trim() || "‚Äî";
            const isp = document.getElementById("ispValue")?.textContent?.trim() || "‚Äî";
            const org = document.getElementById("orgValue")?.textContent?.trim() || "‚Äî";
            const hostname = document.getElementById("hostnameValue")?.textContent?.trim() || "‚Äî";
            const timezone = document.getElementById("timezoneValue")?.textContent?.trim() || "‚Äî";

            // Create search object
            const search = {
                id: Date.now(),
                ip, 
                ipType,
                country, 
                city, 
                region, 
                coordinates, 
                address,
                isp, 
                org, 
                hostname, 
                timezone,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleString()
            };

            console.log("Search data to save:", search);

            // Save to localStorage
            let searches = JSON.parse(localStorage.getItem("recentSearches") || "[]");
            console.log("Existing searches before:", searches);
            
            // Remove duplicates (same IP)
            searches = searches.filter(s => s.ip !== ip);
            
            // Add new search to beginning
            searches.unshift(search);
            
            // Keep only last 20 searches
            searches = searches.slice(0, 20);
            
            // Save back to localStorage
            localStorage.setItem("recentSearches", JSON.stringify(searches));
            
            console.log("Search saved successfully! Total searches now:", searches.length);
            alert(`Search saved for IP: ${ip}`);
            
            // Optional: Update the button text temporarily to show success
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<span class="btn-icon">‚úÖ</span> Saved!';
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
            }, 2000);
        });
        
        console.log("Save search event listener added successfully!");
    } else {
        console.error("Save search button not found!");
    }
    
    console.log("Location-info page setup complete!");
});
</script>
  </body>
</html>