<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recent Searches | IP Insight Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="src/styles/styles.css">
    <link rel="shortcut icon" href="public/images/favicon.ico" type="image/x-icon">
     <script src="https://lawson-mutsa.github.io/geolocation-web-app/src/scripts/scripts.js" defer></script>
  </head>
  <body>
    <header>
      <div class="header-content">
        <div class="logo-container">
          <a href="index.html" class="logo-link">
            <img src="public/images/logo.png" alt="IP Insight Logo" width="40" height="40">
            <span class="logo-text">IP Insight</span>
          </a>
        </div>
        <nav>
          <a href="index.html" class="nav-link">Home</a>
          <a href="recent-searches.html" class="nav-link active">Recent</a>
        </nav>
      </div>
    </header>

    <main class="recent-searches-main">
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">
            <span class="title-icon">ğŸ“š</span>
            Recent IP Searches
          </h1>
          <button class="back-btn" onclick="window.history.back()">
            <span class="btn-icon">â†</span>
            Back
          </button>
        </div>

        <div class="recent-content">
          <div class="recent-stats">
            <div class="stat-card">
              <div class="stat-icon">ğŸ”</div>
              <div class="stat-info">
                <span class="stat-number" id="totalSearches">0</span>
                <span class="stat-label">Total Searches</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">ğŸŒ</div>
              <div class="stat-info">
                <span class="stat-number" id="uniqueCountries">0</span>
                <span class="stat-label">Countries</span>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">â°</div>
              <div class="stat-info">
                <span class="stat-number" id="lastSearch">â€”</span>
                <span class="stat-label">Last Search</span>
              </div>
            </div>
          </div>

          <div class="recent-list-container">
            <div class="list-header">
              <h2>Search History</h2>
              <button class="clear-btn" id="clearHistoryBtn">
                <span class="btn-icon">ğŸ—‘ï¸</span>
                Clear All
              </button>
            </div>
            
            <div class="recent-list" id="recentList">
              <div class="empty-state">
                <span class="empty-icon">ğŸ“­</span>
                <h3>No Recent Searches</h3>
                <p>Your IP search history will appear here.</p>
                <a href="index.html" class="action-btn primary">
                  <span class="btn-icon">ğŸ”</span>
                  Start Searching
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Notification Toast -->
    <div class="toast" id="toast"></div>
  </body>
  <script>
// Recent searches functionality
document.addEventListener('DOMContentLoaded', function() {
    console.log("Loading recent searches...");
    
    const searches = JSON.parse(localStorage.getItem("recentSearches") || "[]");
    console.log("Found searches:", searches);
    
    const totalSearchesElem = document.getElementById("totalSearches");
    const uniqueCountriesElem = document.getElementById("uniqueCountries");
    const lastSearchElem = document.getElementById("lastSearch");
    const recentListElem = document.getElementById("recentList");
    const clearHistoryBtn = document.getElementById("clearHistoryBtn");

    // Update statistics
    if (totalSearchesElem) totalSearchesElem.textContent = searches.length;
    if (uniqueCountriesElem) {
        const uniqueCountries = [...new Set(searches.map(s => s.country).filter(c => c && c !== "â€”"))];
        uniqueCountriesElem.textContent = uniqueCountries.length;
    }
    if (lastSearchElem) {
        lastSearchElem.textContent = searches.length > 0 ? 
            new Date(searches[0].timestamp).toLocaleDateString() : "â€”";
    }

    // Update the list
    if (recentListElem) {
        if (searches.length === 0) {
            recentListElem.innerHTML = `
                <div class="empty-state">
                    <span class="empty-icon">ğŸ“­</span>
                    <h3>No Recent Searches</h3>
                    <p>Your IP search history will appear here.</p>
                    <a href="index.html" class="action-btn primary">
                        <span class="btn-icon">ğŸ”</span>
                        Start Searching
                    </a>
                </div>`;
        } else {
            recentListElem.innerHTML = searches.map(search => `
                <div class="recent-search-card">
                    <div class="search-card-header">
                        <div class="search-ip-info">
                            <span class="ip-address">${search.ip}</span>
                            <span class="ip-type-badge">${search.ipType}</span>
                        </div>
                        <span class="search-date">${new Date(search.timestamp).toLocaleDateString()}</span>
                    </div>
                    <div class="search-card-content">
                        <div class="search-location">
                            <span class="location-icon">ğŸ“</span>
                            ${search.city !== "â€”" ? search.city + ", " : ""}${search.country !== "â€”" ? search.country : "Unknown location"}
                        </div>
                        <div class="search-isp">${search.isp !== "â€”" ? search.isp : "Unknown ISP"}</div>
                    </div>
                    <div class="search-card-actions">
                        <button class="view-search-btn action-btn" onclick="sessionStorage.setItem('selectedIP', '${search.ip}'); window.location.href='location-info.html';">
                            <span class="btn-icon">ğŸ”</span>
                            View Details
                        </button>
                        <button class="delete-search-btn action-btn secondary" onclick="deleteSearch(${search.id})">
                            <span class="btn-icon">ğŸ—‘ï¸</span>
                        </button>
                    </div>
                </div>
            `).join("");
        }
    }

    // Clear history button
    if (clearHistoryBtn) {
        clearHistoryBtn.addEventListener("click", function() {
            if (searches.length === 0) {
                alert("No searches to clear");
                return;
            }
            
            if (confirm("Are you sure you want to clear all recent searches?")) {
                localStorage.removeItem("recentSearches");
                alert("All searches cleared");
                window.location.reload();
            }
        });
    }
});

// Delete search function
function deleteSearch(searchId) {
    if (confirm("Are you sure you want to delete this search?")) {
        let searches = JSON.parse(localStorage.getItem("recentSearches") || "[]");
        searches = searches.filter(search => search.id !== searchId);
        localStorage.setItem("recentSearches", JSON.stringify(searches));
        alert("Search deleted");
        window.location.reload();
    }
}
</script>
</html>